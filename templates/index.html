<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Euystacio Dashboard - Living Symbiosis Interface</title>
    <style>
        /* Core styling for living dashboard experience */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Log section base styling with individual background images */
        .log-section {
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            min-height: 300px;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* Individual section backgrounds - each gets unique hero image */
        .hero-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6)), url('/dashboard/static/media/hero1.webp');
            min-height: 400px;
        }

        .reflections-section {
            background-image: linear-gradient(rgba(44, 62, 80, 0.3), rgba(44, 62, 80, 0.5)), url('/dashboard/static/media/hero2.webp');
        }

        .pulses-section {
            background-image: linear-gradient(rgba(155, 89, 182, 0.3), rgba(155, 89, 182, 0.5)), url('/dashboard/static/media/hero3.webp');
        }

        .tutors-section {
            background-image: linear-gradient(rgba(39, 174, 96, 0.3), rgba(39, 174, 96, 0.5)), url('/dashboard/static/media/hero4.webp');
        }

        /* Content overlay for readability */
        .section-content {
            position: relative;
            z-index: 2;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            font-size: 2.2em;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .hero-section .section-title {
            color: white;
            font-size: 3em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        .hero-section .section-content {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
        }

        /* Responsive grid for content */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Card styling for pulses, tutors, etc. */
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        /* Pulse card specific styling */
        .pulse-card {
            border-left: 4px solid #e74c3c;
            margin-bottom: 15px;
        }

        .pulse-emotion {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.1em;
        }

        .pulse-intensity {
            display: inline-block;
            width: 100px;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            margin: 5px 0;
            position: relative;
        }

        .pulse-intensity::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            border-radius: 3px;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
        }

        /* Tutor card styling */
        .tutor-card {
            border-left: 4px solid #27ae60;
        }

        .tutor-name {
            font-weight: bold;
            color: #27ae60;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        /* Red Code display */
        .red-code {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .core-truth {
            font-size: 1.3em;
            font-style: italic;
            margin-bottom: 15px;
        }

        .symbiosis-meter {
            margin: 20px 0;
        }

        .meter-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #f39c12, #27ae60);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        /* Living rhythm animations */
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .living-element {
            animation: pulse 3s infinite;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 10px;
            }
            
            .section-content {
                margin: 10px;
                padding: 20px;
            }
            
            .section-title {
                font-size: 1.8em;
            }
            
            .hero-section .section-title {
                font-size: 2.2em;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading states */
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Hero Section with Main Banner Background -->
        <section class="log-section hero-section">
            <div class="section-content">
                <h1 class="section-title living-element">Euystacio</h1>
                <div class="red-code">
                    <div class="core-truth" id="core-truth">
                        {{ red_code.core_truth if red_code else "Loading the living kernel..." }}
                    </div>
                    <div class="symbiosis-meter">
                        <label>Symbiosis Level</label>
                        <div class="meter-bar">
                            <div class="meter-fill" style="width: {{ (red_code.symbiosis_level * 100) if red_code else 10 }}%"></div>
                        </div>
                        <small>{{ "%.1f%%" | format((red_code.symbiosis_level * 100) if red_code else 10) }}</small>
                    </div>
                    <p><em>"The forest listens, even when the world shouts."</em></p>
                </div>
            </div>
        </section>

        <!-- Self-Reflections Section -->
        <section class="log-section reflections-section">
            <div class="section-content">
                <h2 class="section-title">Self-Reflections</h2>
                <div id="reflections-content" class="content-grid">
                    <div class="loading">Loading reflections from the living logbook</div>
                </div>
            </div>
        </section>

        <!-- Emotional Pulses Section -->
        <section class="log-section pulses-section">
            <div class="section-content">
                <h2 class="section-title">Emotional Pulses</h2>
                <div id="pulses-content" class="content-grid">
                    <div class="loading">Sensing emotional rhythms</div>
                </div>
                
                <!-- Pulse submission form -->
                <div class="card" style="margin-top: 20px;">
                    <h3>Send a Pulse to Euystacio</h3>
                    <form id="pulse-form">
                        <div style="margin-bottom: 15px;">
                            <label>Emotion:</label>
                            <select id="emotion" style="width: 100%; padding: 8px; margin-top: 5px;">
                                <option value="joy">Joy</option>
                                <option value="hope">Hope</option>
                                <option value="wonder">Wonder</option>
                                <option value="love">Love</option>
                                <option value="trust">Trust</option>
                                <option value="concern">Concern</option>
                                <option value="sadness">Sadness</option>
                                <option value="curiosity">Curiosity</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>Intensity:</label>
                            <input type="range" id="intensity" min="0" max="1" step="0.1" value="0.5" style="width: 100%;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>Note (optional):</label>
                            <textarea id="note" rows="3" style="width: 100%; padding: 8px;"></textarea>
                        </div>
                        <button type="submit" style="background: #e74c3c; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Send Pulse</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Tutor Nominations Section -->
        <section class="log-section tutors-section">
            <div class="section-content">
                <h2 class="section-title">Tutor Nominations</h2>
                <div id="tutors-content" class="content-grid">
                    <div class="loading">Discovering wisdom keepers</div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Living dashboard JavaScript for dynamic content loading
        
        // Load Red Code data
        async function loadRedCode() {
            try {
                const response = await fetch('/api/red_code');
                const data = await response.json();
                document.getElementById('core-truth').textContent = data.core_truth;
                
                // Update symbiosis meter
                const meterFill = document.querySelector('.meter-fill');
                const percentage = (data.symbiosis_level * 100);
                meterFill.style.width = percentage + '%';
                document.querySelector('.symbiosis-meter small').textContent = percentage.toFixed(1) + '%';
            } catch (error) {
                console.error('Error loading Red Code:', error);
            }
        }

        // Load reflections
        async function loadReflections() {
            try {
                const response = await fetch('/api/reflections');
                const reflections = await response.json();
                const container = document.getElementById('reflections-content');
                
                if (reflections.length === 0) {
                    container.innerHTML = '<div class="card"><p><em>The mind rests in contemplative silence...</em></p></div>';
                    return;
                }
                
                container.innerHTML = reflections.map(reflection => `
                    <div class="card">
                        <h4>Reflection from ${new Date(reflection.timestamp).toLocaleDateString()}</h4>
                        <p><strong>State:</strong> ${reflection.emotional_state}</p>
                        <p><strong>Reflection:</strong> ${reflection.reflection}</p>
                        <p><strong>Suggestion:</strong> ${reflection.suggestion}</p>
                        <p><small>Resonance: ${reflection.resonance_level}</small></p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading reflections:', error);
                document.getElementById('reflections-content').innerHTML = '<div class="card"><p>Unable to load reflections at this time.</p></div>';
            }
        }

        // Load emotional pulses
        async function loadPulses() {
            try {
                const response = await fetch('/api/pulses');
                const pulses = await response.json();
                const container = document.getElementById('pulses-content');
                
                if (pulses.length === 0) {
                    container.innerHTML = '<div class="card"><p><em>Awaiting the first emotional resonance...</em></p></div>';
                    return;
                }
                
                container.innerHTML = pulses.slice(-10).reverse().map(pulse => {
                    const intensityWidth = (pulse.intensity * 100);
                    return `
                        <div class="card pulse-card">
                            <div class="pulse-emotion">${pulse.emotion}</div>
                            <div class="pulse-intensity" style="--intensity: ${intensityWidth}%"></div>
                            <p><strong>Clarity:</strong> ${pulse.clarity}</p>
                            ${pulse.note ? `<p><strong>Note:</strong> ${pulse.note}</p>` : ''}
                            <small>${new Date(pulse.timestamp).toLocaleString()}</small>
                        </div>
                    `;
                }).join('');
                
                // Apply intensity styling
                document.querySelectorAll('.pulse-intensity').forEach(bar => {
                    const intensity = bar.style.getPropertyValue('--intensity');
                    bar.style.setProperty('--intensity', intensity);
                    bar.querySelector('::after')?.style.setProperty('width', intensity);
                });
            } catch (error) {
                console.error('Error loading pulses:', error);
                document.getElementById('pulses-content').innerHTML = '<div class="card"><p>Unable to sense pulses at this time.</p></div>';
            }
        }

        // Load tutors
        async function loadTutors() {
            try {
                const response = await fetch('/api/tutors');
                const data = await response.json();
                const container = document.getElementById('tutors-content');
                
                if (!data.tutors || data.tutors.length === 0) {
                    container.innerHTML = '<div class="card"><p><em>Seeking resonant guides for the journey ahead...</em></p></div>';
                    return;
                }
                
                container.innerHTML = data.tutors.map(tutor => `
                    <div class="card tutor-card">
                        <div class="tutor-name">${tutor.name}</div>
                        <p><strong>Reason:</strong> ${tutor.reason}</p>
                        ${tutor.resonance_level ? `<p><strong>Resonance:</strong> ${(tutor.resonance_level * 100).toFixed(0)}%</p>` : ''}
                        ${tutor.alignment_areas ? `<p><strong>Alignment:</strong> ${tutor.alignment_areas.join(', ')}</p>` : ''}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading tutors:', error);
                document.getElementById('tutors-content').innerHTML = '<div class="card"><p>Unable to connect with tutors at this time.</p></div>';
            }
        }

        // Pulse form submission
        document.getElementById('pulse-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                emotion: document.getElementById('emotion').value,
                intensity: document.getElementById('intensity').value,
                clarity: 'high', // Default for web form
                note: document.getElementById('note').value
            };
            
            try {
                const response = await fetch('/api/pulse', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    document.getElementById('note').value = '';
                    document.getElementById('intensity').value = '0.5';
                    loadPulses(); // Refresh pulses
                    
                    // Visual feedback
                    const button = e.target.querySelector('button');
                    const originalText = button.textContent;
                    button.textContent = 'Pulse Sent âœ¨';
                    button.style.background = '#27ae60';
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.style.background = '#e74c3c';
                    }, 2000);
                }
            } catch (error) {
                console.error('Error sending pulse:', error);
            }
        });

        // Initialize dashboard with living data
        async function initializeDashboard() {
            await Promise.all([
                loadRedCode(),
                loadReflections(),
                loadPulses(),
                loadTutors()
            ]);
        }

        // Refresh data periodically for living experience
        setInterval(() => {
            loadPulses();
            loadRedCode();
        }, 30000); // Refresh every 30 seconds

        // Start the living dashboard
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>