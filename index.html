<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sentimento Pulse Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container">
    <h1 class="mt-5">Sentimento Pulse Dashboard</h1>
    <form id="pulseForm" class="mb-4">
        <div class="form-group">
            <label for="emotion">Emotion</label>
            <input type="text" class="form-control" id="emotion" name="emotion" required>
        </div>
        <div class="form-group">
            <label for="intensity">Intensity (0-1)</label>
            <input type="number" step="0.01" min="0" max="1" class="form-control" id="intensity" name="intensity" required>
        </div>
        <div class="form-group">
            <label for="clarity">Clarity</label>
            <select class="form-control" id="clarity" name="clarity">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
            </select>
        </div>
        <div class="form-group">
            <label for="note">Note</label>
            <input type="text" class="form-control" id="note" name="note">
        </div>
        <button type="submit" class="btn btn-primary">Send Pulse</button>
    </form>
    <div id="pulseResult" class="alert d-none"></div>

    <h2 class="mt-5">Recent Pulses</h2>
    <ul id="pulseList" class="list-group"></ul>

    <h2 class="mt-5">Reflections</h2>
    <ul id="reflectionList" class="list-group"></ul>
</div>

<script>
$(document).ready(function() {
    function loadPulses() {
        $.get("/api/pulses", function(data) {
            let list = $("#pulseList");
            list.empty();
            data.forEach(function(pulse) {
                list.append(`<li class=\"list-group-item\">${JSON.stringify(pulse)}</li>`);
            });
        });
    }
    function loadReflections() {
        $.get("/api/reflections", function(data) {
            let list = $("#reflectionList");
            list.empty();
            data.forEach(function(ref) {
                list.append(`<li class=\"list-group-item\">${JSON.stringify(ref)}</li>`);
            });
        });
    }

    $("#pulseForm").submit(function(e) {
        e.preventDefault();
        let payload = {
            emotion: $("#emotion").val(),
            intensity: $("#intensity").val(),
            clarity: $("#clarity").val(),
            note: $("#note").val()
        };
        $.ajax({
            url: "/api/pulse",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(payload),
            success: function(result) {
                $("#pulseResult").text(JSON.stringify(result)).removeClass("d-none").addClass("alert-success");
                loadPulses();
            },
            error: function(err) {
                $("#pulseResult").text("Error sending pulse!").removeClass("d-none").addClass("alert-danger");
            }
        });
    });

    loadPulses();
    loadReflections();
});
</script>
</body>
</html>
